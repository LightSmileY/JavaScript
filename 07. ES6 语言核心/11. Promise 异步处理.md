# Promise 异步处理

### 1. 回调地狱

```javascript
function loadImg(src, callback, fail) {
    var img = document.createElement('img')
    img.onload = function(){
        callback(img)
    }
    img.onerror = function(){
        fail()
    }
    img.src = src
}

var src = 'https://www.w3cschool.cn/attachments/image/20190104/1546566327607494.png'
loadImg(src, function(img){
    console.log(img.width)
}, function(){
    console.log('failed')
})
```

![img](https://www.w3cschool.cn/attachments/image/20190104/1546566327607494.png)

<br/>

### 2. Promise

#### 2.1 Promise语法

```javascript
function loadImg(src){
    return new Promise((resolve, reject) => {
        let img = document.createElement('img')
        img.onload = () => {
            resolve(img)
        }
        img.onerror = () => {
            reject()
        }
    })
}

let src = 'https://www.w3cschool.cn/attachments/image/20190104/1546566327607494.png'
let result = loadImg(src)

result
.then(res => {
    console.log(res.width)
})
.catch(error => {
    console.log('failed')
})
```

#### 2.2 使用步骤总结

- **new Promise 实例，而且要 return**
- **new Promise 时要传入参数，函数有 resolve和reject 两个参数**
- **成功时执行 resolve()，失败时执行 reject()**
- **then, catch 等监听结果**

